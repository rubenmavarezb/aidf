# TASK: Create ReportWriter Class

## Goal
Create `core/report-writer.ts` with a `ReportWriter` class responsible for persisting, reading, listing, and aggregating execution reports.

Responsibilities:
- `write(report: ExecutionReport): string` -- persists report as JSON to `.ai/reports/YYYY-MM-DD/run-{runId}.json`. Returns the file path.
- Creates directory structure automatically (`mkdirSync` with `recursive: true`)
- File naming: `run-{runId}.json` where runId is the first 8 chars of the UUID for readability
- Supports configurable base directory (default: `.ai/reports/`)
- `list(options?: { since?, until?, status?, task? }): ReportSummary[]` -- reads all report files, applies filters, returns sorted array of summaries (lightweight: only metadata + outcome, no per-iteration detail)
- `read(runId: string): ExecutionReport | null` -- reads a specific report by ID (supports partial ID matching)
- `aggregate(reports: ExecutionReport[]): AggregateMetrics` -- computes totals and averages across multiple reports: total cost, total tokens, average iterations, success rate, average duration, most modified files
- File format: pretty-printed JSON (2-space indent) for human readability when debugging
- Add `.ai/reports/` to the default `.gitignore` generated by `aidf init` (reports contain local paths and are per-machine)

Also define:
- `ReportSummary` interface: lightweight summary with metadata + outcome (no per-iteration detail)
- `AggregateMetrics` interface: totals and averages across multiple reports

## Task Type
feature

## Suggested Roles
- developer

## Auto-Mode Compatible
YES

## Scope
### Allowed
- packages/cli/src/core/report-writer.ts
- packages/cli/src/core/report-writer.test.ts
- packages/cli/src/types/index.ts
- packages/cli/src/commands/init.ts
- templates/.ai/.gitignore

### Forbidden
- packages/cli/src/core/executor.ts (read-only)
- packages/cli/src/commands/run.ts (read-only)

## Requirements
- Use `fs.mkdirSync` with `recursive: true` for directory creation
- JSON output must be pretty-printed (2-space indent)
- `list()` must support filtering by date range, status, and task name/glob
- `read()` must support partial ID matching (first N characters of runId)
- `aggregate()` must compute: total cost, total tokens, average iterations, success rate, average duration, most modified files (top 10)
- Report files stored under `.ai/reports/YYYY-MM-DD/run-{shortId}.json`
- Add `.ai/reports/` to `.gitignore` template

## Definition of Done
- [ ] `ReportWriter` class created in `core/report-writer.ts`
- [ ] `write()` persists report as JSON and returns file path
- [ ] `list()` reads, filters, and returns sorted summaries
- [ ] `read()` reads a specific report with partial ID matching
- [ ] `aggregate()` computes totals and averages
- [ ] `ReportSummary` and `AggregateMetrics` interfaces defined in `types/index.ts`
- [ ] `.ai/reports/` added to `.gitignore` template
- [ ] Unit tests verify write/read round-trip, directory creation, filtering, aggregation math
- [ ] TypeScript compiles with no errors (`pnpm typecheck`)
- [ ] All tests pass (`pnpm test`)

## Notes
- Part of PLAN-v080-observability.md
- Depends on task 124 (ExecutionReport schema)
- Independent of tasks 125/126
