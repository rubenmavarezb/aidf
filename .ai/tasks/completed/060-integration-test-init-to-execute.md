# TASK: Add integration test for init-to-execute config pipeline

## Goal

Add an integration test that verifies config generated by `aidf init` can be correctly loaded and used by the Executor, catching mismatches like the autoCommit bug.

## Task Type

test

## Suggested Roles

- tester

## Auto-Mode Compatible

YES - Pure test addition, no production code changes.

## Scope

### Allowed

- `packages/cli/src/core/executor.test.ts` (or a new integration test file)
- `packages/cli/src/utils/config.test.ts`

### Forbidden

- `packages/cli/src/commands/init.ts` (read-only)
- `packages/cli/src/core/executor.ts` (read-only)
- `templates/**`

## Requirements

1. Create a test that:
   - Generates a config object using the same structure as `init.ts` (the legacy format with `behavior.autoCommit`, `validation.lint`, etc.)
   - Passes it through `normalizeConfig()`
   - Asserts that the resulting config has the correct `permissions.auto_commit`, `permissions.scope_enforcement`, `validation.pre_commit[]`, etc.
   - Asserts the config can be used to construct an `Executor` without errors

2. Create a test that:
   - Generates a config with `behavior.autoCommit: false`
   - Normalizes it
   - Constructs an `Executor` with the config
   - Verifies `this.options.autoCommit` is `false` (not the default `true`)

3. Create a test with the correct/new format to verify it also works:
   - Config with `permissions.auto_commit: false` directly
   - Normalizes it (should pass through unchanged)
   - Same assertion

## Definition of Done

- [ ] At least 3 integration tests covering: legacy format, new format, and autoCommit=false pipeline
- [ ] Tests verify the full path: raw config -> normalizeConfig -> Executor options
- [ ] `pnpm test` — all tests pass
- [ ] Tests are in a clearly labeled `describe('config integration')` block

## Notes

- This test would have caught the autoCommit bug before it shipped
- The Executor constructor reads `config.permissions?.auto_commit ?? true` — the test must verify this specific path
- May need to mock `simpleGit` and `createProvider` to construct Executor in test context (follow existing executor.test.ts patterns)
